/// <reference path="../typings/main.d.ts" />
var program = require('commander');
var request = require('request');
var fs = require('fs');
var _ = require("lodash");
var Promise = require('promise');
var typesMap = {
    "integer": "number",
    "object": "any"
};
var StringWriter = (function () {
    function StringWriter() {
        this.buffer = "";
    }
    StringWriter.prototype.write = function (chunk) {
        this.buffer += chunk;
    };
    StringWriter.prototype.end = function () {
    };
    StringWriter.prototype.toString = function () {
        return this.buffer;
    };
    return StringWriter;
})();
var StreamWriter = (function () {
    function StreamWriter(stream) {
        this.stream = stream;
    }
    StreamWriter.prototype.write = function (chunk) {
        this.stream.write(chunk);
    };
    StreamWriter.prototype.end = function () {
        this.stream.end();
    };
    return StreamWriter;
})();
var IndentedTextWriter = (function () {
    function IndentedTextWriter(writer, newLine, tabString) {
        if (newLine === void 0) { newLine = "\r\n"; }
        if (tabString === void 0) { tabString = "    "; }
        this.writer = writer;
        this.newLine = newLine;
        this.tabString = tabString;
        this.indent = 0;
    }
    IndentedTextWriter.prototype.write = function (chunk) {
        this.writer.write(chunk);
    };
    IndentedTextWriter.prototype.startIndentedLine = function (chunk) {
        if (chunk === void 0) { chunk = ""; }
        this.write(Array(this.indent + 1).join(this.tabString) + chunk);
    };
    IndentedTextWriter.prototype.writeLine = function (chunk) {
        if (chunk === void 0) { chunk = ""; }
        this.startIndentedLine(chunk + this.newLine);
    };
    IndentedTextWriter.prototype.end = function () {
        this.writer.end();
    };
    return IndentedTextWriter;
})();
var TypescriptTextWriter = (function () {
    function TypescriptTextWriter(writer) {
        this.writer = writer;
    }
    TypescriptTextWriter.prototype.braces = function (text, context) {
        this.writer.writeLine(text + " {");
        this.writer.indent++;
        context(this);
        this.writer.indent--;
        this.writer.writeLine("}");
    };
    TypescriptTextWriter.prototype.reference = function (path) {
        this.writer.writeLine("/// <reference path=\"" + path + "\" />");
    };
    TypescriptTextWriter.prototype.namespace = function (name, context) {
        this.writer.writeLine();
        this.braces("namespace " + name, context);
    };
    TypescriptTextWriter.prototype.declareNamespace = function (name, context) {
        this.writer.writeLine();
        this.braces("declare namespace " + name, context);
    };
    TypescriptTextWriter.prototype.interface = function (name, context) {
        this.writer.writeLine();
        this.braces("interface " + name, context);
    };
    TypescriptTextWriter.prototype.anonymysType = function (context) {
        this.writer.write("{");
        this.writer.writeLine();
        this.writer.indent++;
        context(this);
        this.writer.indent--;
        this.writer.startIndentedLine("}");
    };
    TypescriptTextWriter.prototype.property = function (name, type, required) {
        if (required === void 0) { required = true; }
        if (typeof type === 'function') {
            this.writer.startIndentedLine("" + name + (required ? "" : "?") + ": ");
            type(this);
            this.writer.write(",");
            this.writer.writeLine();
        }
        else if (typeof type === 'string') {
            this.writer.writeLine("" + name + (required ? "" : "?") + ": " + type + ",");
        }
    };
    TypescriptTextWriter.prototype.comment = function (text) {
        var _this = this;
        if (text === void 0) { text = ""; }
        var lines = text.split(/\r\n|\r|\n|\u000a\u000d|\u000a|\u000d|\u240a/g);
        _.forEach(lines, function (line) { return _this.writer.writeLine("// " + line); });
    };
    TypescriptTextWriter.prototype.method = function (name, parameters, returnType) {
        this.writer.writeLine(name + "(" + parameters.map(function (p) { return p.parameter + ": " + p.type; }).join(", ") + "): " + returnType + ";");
    };
    TypescriptTextWriter.prototype.writeLine = function (chunk) {
        if (chunk === void 0) { chunk = ""; }
        this.writer.writeLine(chunk);
    };
    TypescriptTextWriter.prototype.write = function (chunk) {
        if (chunk === void 0) { chunk = ""; }
        this.writer.write(chunk);
    };
    TypescriptTextWriter.prototype.end = function () {
        this.writer.end();
    };
    return TypescriptTextWriter;
})();
function processResource(resource) {
    var childs = _.map(resource.resources || {}, function (value) { return processResource(value); });
    return _.union(_.map(resource.methods || {}, function (value) { return value; }), childs);
}
function getNamespace(path) {
    var parts = path.split('.');
    if (parts.length > 0) {
        parts.splice(parts.length - 1);
        var n = _.camelCase(parts.join('.'));
        return parts.join('.');
    }
    else
        return null;
}
function getName(path) {
    var parts = path.split('.');
    if (parts.length > 0)
        return _.last(parts);
    else
        return null;
}
function formatParameters(method, out) {
    out("{");
    _.forEach(method.parameters, function (data, key) {
        out("\t" + key + ": " + (typesMap[data.type] || data.type) + ",");
    });
    out("}");
    //return "{ \r\n\t\t" + _.map(method.parameters, (data, key) => key + ": " + (typesMap[data.type] || data.type)).join(", \r\n\t\t") + "\r\n\t\t }";
}
function firstLetterUp(text) {
    return text[0].toUpperCase() + text.substring(1);
}
function getMethodParameterInterfaceName(resource, method) {
    return firstLetterUp(resource) + firstLetterUp(getName(method.id)) + "Request";
}
function getType(type) {
    if (type.type === "array") {
        return function (writer) {
            var child = getType(type.items);
            if (typeof child === "string") {
                writer.write(child);
            }
            else if (typeof child === "function") {
                child(writer);
            }
            writer.write("[]");
        };
    }
    else if (type.type === "object" && type.properties) {
        return function (writer) {
            writer.anonymysType(function () {
                return _.forEach(type.properties, function (data, key) {
                    writer.comment(formatComment(data.description));
                    writer.property(key, getType(data), data.required || false);
                });
            });
        };
    }
    else if (type.type) {
        return typesMap[type.type] || type.type;
    }
    else if (type.$ref) {
        return type.$ref;
    }
    else
        throw Error();
}
function formatComment(comment) {
    if (!comment)
        return "";
    return comment;
}
function getMethodReturn(method) {
    if (method.response) {
        return "PromiseLike<ApiResult<" + method.response.$ref + ">>";
    }
    else {
        return "PromiseLike<void>";
    }
}
var App = (function () {
    function App(output) {
        if (output === void 0) { output = __dirname + "/../out/"; }
        this.output = output;
        console.log("output directory: " + this.output);
        console.log();
    }
    // writes specified resource definition
    App.prototype.writeResources = function (out, resources) {
        var _this = this;
        _.forEach(resources, function (resource, resourceName) {
            var resourceInterfaceName = resourceName[0].toUpperCase() + resourceName.substring(1) + "Resource";
            _this.writeResources(out, resource.resources);
            _.forEach(resource.methods, function (method, name) {
                out.interface(getMethodParameterInterfaceName(resourceName, method), function () {
                    _.forEach(method.parameters, function (parameter, key) {
                        out.comment(formatComment(parameter.description));
                        out.property(key, typesMap[parameter.type] || parameter.type, parameter.required || false);
                    });
                });
            });
            out.interface(resourceInterfaceName, function () {
                _.forEach(resource.methods, function (method, name) {
                    out.comment(formatComment(method.description));
                    out.method(getName(method.id), [{ parameter: "request", type: getMethodParameterInterfaceName(resourceName, method) }], getMethodReturn(method));
                });
                _.forEach(resource.resources, function (childResource, childResourceName) {
                    var childResourceInterfaceName = childResourceName[0].toUpperCase() + childResourceName.substring(1) + "Resource";
                    out.property(childResourceName, childResourceInterfaceName);
                });
            });
            out.writeLine();
            out.writeLine("var " + resourceName + ": " + resourceInterfaceName + ";");
            out.writeLine();
        });
    };
    /// writes api description for specified JSON object
    App.prototype.processApi = function (api, actualVersion) {
        var _this = this;
        console.log("Generating " + api.id + " definitions...");
        var methods = _(processResource(api)).flatten(true).map(function (x) {
            return {
                namespace: getNamespace(x.id),
                name: getName(x.id),
                method: x
            };
        }).value(), grouped = _.groupBy(methods, function (method) { return method.namespace; }), stream = fs.createWriteStream(this.output + api.name + (actualVersion ? "" : "-" + api.version) + ".d.ts"), writer = new TypescriptTextWriter(new IndentedTextWriter(new StreamWriter(stream)));
        writer.reference("gapi.d.ts");
        writer.declareNamespace("gapi", function () {
            writer.namespace("client", function () {
                _.forEach(api.schemas, function (schema, key) {
                    writer.interface(schema.id, function () {
                        _.forEach(schema.properties, function (data, key) {
                            writer.comment(formatComment(data.description));
                            writer.property(key, getType(data), data.required || false);
                        });
                    });
                });
                _this.writeResources(writer, api.resources);
            });
        });
        writer.end();
    };
    App.prototype.request = function (url) {
        return new Promise(function (resolve, reject) {
            request(url, function (error, response, body) {
                if (!error && response.statusCode == 200) {
                    var api = JSON.parse(body);
                    resolve(api);
                }
                else {
                    console.error("Got an error: ", error, ", status code: ", response.statusCode);
                    reject(error);
                }
            });
        });
    };
    App.prototype.filterServices = function (apis, service, allVersions) {
        apis = _.filter(apis, function (api) { return service == null || api.name === service; });
        // _(apis)
        //     .groupBy(api => api.name)
        //     .each((variants, key) => _.each(variants, v => v.actualVersion = v === _.last(variants)))
        //     .value();
        apis = _.filter(apis, function (api) { return allVersions || api.preferred; });
        return apis;
    };
    App.prototype.processService = function (url, actualVersion) {
        var _this = this;
        return this
            .request(url)
            .then(function (api) { return _this.processApi(api, actualVersion); });
    };
    App.prototype.discover = function (service, allVersions) {
        var _this = this;
        if (service === void 0) { service = null; }
        if (allVersions === void 0) { allVersions = false; }
        console.log("Discovering Google services...");
        return this
            .request("https://www.googleapis.com/discovery/v1/apis")
            .then(function (apis) { return _this.filterServices(apis.items, service, allVersions); })
            .then(function (items) {
            if (items.length === 0) {
                console.error("Can't find services");
                throw Error("Can't find services");
            }
            else {
                return items.reduce(function (cur, api) { return cur.then(function () { return _this.processService(api.discoveryRestUrl, api.preferred); }); }, Promise.resolve(null));
            }
        });
    };
    return App;
})();
var params = program
    .version("0.0.1")
    .allowUnknownOption(false)
    .option("-u, --url [url]", "process only specific REST service definition by url")
    .option("-s, --service [name]", "process only specific REST service definition by name")
    .option("-a, --all", "include previously versions", false)
    .option("-o, --out", "output directory")
    .parse(process.argv);
var app = new App(params.out);
if (params.url) {
    app
        .processService(params.url, true)
        .then(function () { return console.log("Done"); });
}
else {
    app
        .discover(params.service, params.all)
        .then(function () { return console.log("Done"); });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ29vZ2xlLWFwaS10eXBpbmdzLWdlbmVyYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9nb29nbGUtYXBpLXR5cGluZ3MtZ2VuZXJhdG9yLnRzIl0sIm5hbWVzIjpbIlN0cmluZ1dyaXRlciIsIlN0cmluZ1dyaXRlci5jb25zdHJ1Y3RvciIsIlN0cmluZ1dyaXRlci53cml0ZSIsIlN0cmluZ1dyaXRlci5lbmQiLCJTdHJpbmdXcml0ZXIudG9TdHJpbmciLCJTdHJlYW1Xcml0ZXIiLCJTdHJlYW1Xcml0ZXIuY29uc3RydWN0b3IiLCJTdHJlYW1Xcml0ZXIud3JpdGUiLCJTdHJlYW1Xcml0ZXIuZW5kIiwiSW5kZW50ZWRUZXh0V3JpdGVyIiwiSW5kZW50ZWRUZXh0V3JpdGVyLmNvbnN0cnVjdG9yIiwiSW5kZW50ZWRUZXh0V3JpdGVyLndyaXRlIiwiSW5kZW50ZWRUZXh0V3JpdGVyLnN0YXJ0SW5kZW50ZWRMaW5lIiwiSW5kZW50ZWRUZXh0V3JpdGVyLndyaXRlTGluZSIsIkluZGVudGVkVGV4dFdyaXRlci5lbmQiLCJUeXBlc2NyaXB0VGV4dFdyaXRlciIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLmNvbnN0cnVjdG9yIiwiVHlwZXNjcmlwdFRleHRXcml0ZXIuYnJhY2VzIiwiVHlwZXNjcmlwdFRleHRXcml0ZXIucmVmZXJlbmNlIiwiVHlwZXNjcmlwdFRleHRXcml0ZXIubmFtZXNwYWNlIiwiVHlwZXNjcmlwdFRleHRXcml0ZXIuZGVjbGFyZU5hbWVzcGFjZSIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLmludGVyZmFjZSIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLmFub255bXlzVHlwZSIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLnByb3BlcnR5IiwiVHlwZXNjcmlwdFRleHRXcml0ZXIuY29tbWVudCIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLm1ldGhvZCIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLndyaXRlTGluZSIsIlR5cGVzY3JpcHRUZXh0V3JpdGVyLndyaXRlIiwiVHlwZXNjcmlwdFRleHRXcml0ZXIuZW5kIiwicHJvY2Vzc1Jlc291cmNlIiwiZ2V0TmFtZXNwYWNlIiwiZ2V0TmFtZSIsImZvcm1hdFBhcmFtZXRlcnMiLCJmaXJzdExldHRlclVwIiwiZ2V0TWV0aG9kUGFyYW1ldGVySW50ZXJmYWNlTmFtZSIsImdldFR5cGUiLCJmb3JtYXRDb21tZW50IiwiZ2V0TWV0aG9kUmV0dXJuIiwiQXBwIiwiQXBwLmNvbnN0cnVjdG9yIiwiQXBwLndyaXRlUmVzb3VyY2VzIiwiQXBwLnByb2Nlc3NBcGkiLCJBcHAucmVxdWVzdCIsIkFwcC5maWx0ZXJTZXJ2aWNlcyIsIkFwcC5wcm9jZXNzU2VydmljZSIsIkFwcC5kaXNjb3ZlciJdLCJtYXBwaW5ncyI6IkFBQUEsNkNBQTZDO0FBRTdDLElBQVksT0FBTyxXQUFNLFdBQVcsQ0FBQyxDQUFBO0FBQ3JDLElBQVksT0FBTyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBQ25DLElBQVksRUFBRSxXQUFNLElBQUksQ0FBQyxDQUFBO0FBQ3pCLElBQVksQ0FBQyxXQUFNLFFBQVEsQ0FBQyxDQUFBO0FBQzVCLElBQVksT0FBTyxXQUFNLFNBQVMsQ0FBQyxDQUFBO0FBRW5DLElBQUksUUFBUSxHQUFHO0lBQ1gsU0FBUyxFQUFFLFFBQVE7SUFDbkIsUUFBUSxFQUFFLEtBQUs7Q0FDbEIsQ0FBQTtBQU9EO0lBQUFBO1FBRVlDLFdBQU1BLEdBQUdBLEVBQUVBLENBQUNBO0lBYXhCQSxDQUFDQTtJQVhVRCw0QkFBS0EsR0FBWkEsVUFBYUEsS0FBYUE7UUFDdEJFLElBQUlBLENBQUNBLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBO0lBQ3pCQSxDQUFDQTtJQUVNRiwwQkFBR0EsR0FBVkE7SUFFQUcsQ0FBQ0E7SUFFTUgsK0JBQVFBLEdBQWZBO1FBQ0lJLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO0lBQ3ZCQSxDQUFDQTtJQUNMSixtQkFBQ0E7QUFBREEsQ0FBQ0EsQUFmRCxJQWVDO0FBRUQ7SUFFSUss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LENBQUMsRUFBbkIsQ0FBbUIsQ0FBQyxDQUFDO0FBQ3pDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy9tYWluLmQudHNcIiAvPlxyXG5cclxuaW1wb3J0ICogYXMgcHJvZ3JhbSBmcm9tICdjb21tYW5kZXInO1xyXG5pbXBvcnQgKiBhcyByZXF1ZXN0IGZyb20gJ3JlcXVlc3QnO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIF8gZnJvbSBcImxvZGFzaFwiO1xyXG5pbXBvcnQgKiBhcyBQcm9taXNlIGZyb20gJ3Byb21pc2UnO1xyXG5cclxudmFyIHR5cGVzTWFwID0ge1xyXG4gICAgXCJpbnRlZ2VyXCI6IFwibnVtYmVyXCIsXHJcbiAgICBcIm9iamVjdFwiOiBcImFueVwiXHJcbn1cclxuXHJcbmludGVyZmFjZSBJVGV4dFdyaXRlciB7XHJcbiAgICB3cml0ZShjaHVuaz8pO1xyXG4gICAgZW5kKCk7XHJcbn1cclxuXHJcbmNsYXNzIFN0cmluZ1dyaXRlciBpbXBsZW1lbnRzIElUZXh0V3JpdGVyIHtcclxuXHJcbiAgICBwcml2YXRlIGJ1ZmZlciA9IFwiXCI7XHJcblxyXG4gICAgcHVibGljIHdyaXRlKGNodW5rOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLmJ1ZmZlciArPSBjaHVuaztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW5kKCkge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdG9TdHJpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBTdHJlYW1Xcml0ZXIgaW1wbGVtZW50cyBJVGV4dFdyaXRlciB7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBzdHJlYW06IGZzLldyaXRlU3RyZWFtKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHdyaXRlKGNodW5rOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLnN0cmVhbS53cml0ZShjaHVuayk7XHJcbiAgICB9XHJcblxyXG4gICAgZW5kKCkge1xyXG4gICAgICAgIHRoaXMuc3RyZWFtLmVuZCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBJbmRlbnRlZFRleHRXcml0ZXIge1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSB3cml0ZXI6IElUZXh0V3JpdGVyLCBwdWJsaWMgbmV3TGluZSA9IFwiXFxyXFxuXCIsIHB1YmxpYyB0YWJTdHJpbmcgPSBcIiAgICBcIikge1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaW5kZW50ID0gMDtcclxuXHJcbiAgICBwdWJsaWMgd3JpdGUoY2h1bms6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlKGNodW5rKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RhcnRJbmRlbnRlZExpbmUoY2h1bmsgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZShBcnJheSh0aGlzLmluZGVudCArIDEpLmpvaW4odGhpcy50YWJTdHJpbmcpICsgY2h1bmspO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB3cml0ZUxpbmUoY2h1bmsgPSBcIlwiKSB7XHJcbiAgICAgICAgdGhpcy5zdGFydEluZGVudGVkTGluZShjaHVuayArIHRoaXMubmV3TGluZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGVuZCgpIHtcclxuICAgICAgICB0aGlzLndyaXRlci5lbmQoKTtcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIElUeXBlc2NyaXB0VGV4dFdyaXRlciB7XHJcbiAgICBuYW1lc3BhY2UobmFtZTogc3RyaW5nLCBjb250ZXh0OiAod3JpdGVyOiBUeXBlc2NyaXB0VGV4dFdyaXRlcikgPT4gdm9pZCk7XHJcbn1cclxuXHJcbnR5cGUgVHlwZXNjcmlwdFdyaXRlckNhbGxiYWNrID0gKHdyaXRlcikgPT4gdm9pZDtcclxuXHJcbmNsYXNzIFR5cGVzY3JpcHRUZXh0V3JpdGVyIGltcGxlbWVudHMgSVR5cGVzY3JpcHRUZXh0V3JpdGVyIHtcclxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgd3JpdGVyOiBJbmRlbnRlZFRleHRXcml0ZXIpIHtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGJyYWNlcyh0ZXh0OiBzdHJpbmcsIGNvbnRleHQ6ICh3cml0ZXI6IFR5cGVzY3JpcHRUZXh0V3JpdGVyKSA9PiB2b2lkKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZXIud3JpdGVMaW5lKHRleHQgKyBcIiB7XCIpO1xyXG4gICAgICAgIHRoaXMud3JpdGVyLmluZGVudCsrO1xyXG4gICAgICAgIGNvbnRleHQodGhpcyk7XHJcbiAgICAgICAgdGhpcy53cml0ZXIuaW5kZW50LS07XHJcbiAgICAgICAgdGhpcy53cml0ZXIud3JpdGVMaW5lKFwifVwiKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVmZXJlbmNlKHBhdGg6IHN0cmluZykge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlTGluZShgLy8vIDxyZWZlcmVuY2UgcGF0aD1cIiR7cGF0aH1cIiAvPmApO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBuYW1lc3BhY2UobmFtZTogc3RyaW5nLCBjb250ZXh0OiBUeXBlc2NyaXB0V3JpdGVyQ2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLndyaXRlci53cml0ZUxpbmUoKTtcclxuICAgICAgICB0aGlzLmJyYWNlcyhgbmFtZXNwYWNlICR7bmFtZX1gLCBjb250ZXh0KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZGVjbGFyZU5hbWVzcGFjZShuYW1lOiBzdHJpbmcsIGNvbnRleHQ6IFR5cGVzY3JpcHRXcml0ZXJDYWxsYmFjaykge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlTGluZSgpO1xyXG4gICAgICAgIHRoaXMuYnJhY2VzKGBkZWNsYXJlIG5hbWVzcGFjZSAke25hbWV9YCwgY29udGV4dCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGludGVyZmFjZShuYW1lOiBzdHJpbmcsIGNvbnRleHQ6IFR5cGVzY3JpcHRXcml0ZXJDYWxsYmFjaykge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlTGluZSgpO1xyXG4gICAgICAgIHRoaXMuYnJhY2VzKGBpbnRlcmZhY2UgJHtuYW1lfWAsIGNvbnRleHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBhbm9ueW15c1R5cGUoY29udGV4dDogVHlwZXNjcmlwdFdyaXRlckNhbGxiYWNrKSB7XHJcbiAgICAgICAgdGhpcy53cml0ZXIud3JpdGUoXCJ7XCIpO1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlTGluZSgpO1xyXG4gICAgICAgIHRoaXMud3JpdGVyLmluZGVudCsrO1xyXG4gICAgICAgIGNvbnRleHQodGhpcyk7XHJcbiAgICAgICAgdGhpcy53cml0ZXIuaW5kZW50LS07XHJcbiAgICAgICAgdGhpcy53cml0ZXIuc3RhcnRJbmRlbnRlZExpbmUoXCJ9XCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBwcm9wZXJ0eShuYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZyB8IFR5cGVzY3JpcHRXcml0ZXJDYWxsYmFjaywgcmVxdWlyZWQgPSB0cnVlKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiB0eXBlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVyLnN0YXJ0SW5kZW50ZWRMaW5lKGAke25hbWV9JHtyZXF1aXJlZCA/IFwiXCIgOiBcIj9cIn06IGApO1xyXG4gICAgICAgICAgICB0eXBlKHRoaXMpO1xyXG4gICAgICAgICAgICB0aGlzLndyaXRlci53cml0ZShcIixcIik7XHJcbiAgICAgICAgICAgIHRoaXMud3JpdGVyLndyaXRlTGluZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgdHlwZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy53cml0ZXIud3JpdGVMaW5lKGAke25hbWV9JHtyZXF1aXJlZCA/IFwiXCIgOiBcIj9cIn06ICR7dHlwZX0sYCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY29tbWVudCh0ZXh0OiBzdHJpbmcgPSBcIlwiKSB7ICAgICAgICBcclxuICAgICAgICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KC9cXHJcXG58XFxyfFxcbnxcXHUwMDBhXFx1MDAwZHxcXHUwMDBhfFxcdTAwMGR8XFx1MjQwYS9nKTtcclxuICAgICAgICBfLmZvckVhY2gobGluZXMsIGxpbmUgPT4gdGhpcy53cml0ZXIud3JpdGVMaW5lKGAvLyAke2xpbmV9YCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBtZXRob2QobmFtZTogc3RyaW5nLCBwYXJhbWV0ZXJzOiBbeyBwYXJhbWV0ZXI6IHN0cmluZywgdHlwZTogc3RyaW5nIH1dLCByZXR1cm5UeXBlOiBzdHJpbmcpIHtcclxuICAgICAgICB0aGlzLndyaXRlci53cml0ZUxpbmUoYCR7bmFtZX0oJHtwYXJhbWV0ZXJzLm1hcChwID0+IHAucGFyYW1ldGVyICsgXCI6IFwiICsgcC50eXBlKS5qb2luKFwiLCBcIil9KTogJHtyZXR1cm5UeXBlfTtgKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgd3JpdGVMaW5lKGNodW5rID0gXCJcIikge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlTGluZShjaHVuayk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHdyaXRlKGNodW5rID0gXCJcIikge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLndyaXRlKGNodW5rKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZW5kKCkge1xyXG4gICAgICAgIHRoaXMud3JpdGVyLmVuZCgpO1xyXG4gICAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBwcm9jZXNzUmVzb3VyY2UocmVzb3VyY2UpIHtcclxuICAgIHZhciBjaGlsZHMgPSBfLm1hcChyZXNvdXJjZS5yZXNvdXJjZXMgfHwge30sIHZhbHVlID0+IHByb2Nlc3NSZXNvdXJjZSh2YWx1ZSkpO1xyXG4gICAgcmV0dXJuIF8udW5pb24oXy5tYXAocmVzb3VyY2UubWV0aG9kcyB8fCB7fSwgdmFsdWUgPT4gdmFsdWUpLCBjaGlsZHMpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXROYW1lc3BhY2UocGF0aDogc3RyaW5nKSB7XHJcbiAgICB2YXIgcGFydHMgPSBwYXRoLnNwbGl0KCcuJyk7XHJcblxyXG4gICAgaWYgKHBhcnRzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBwYXJ0cy5zcGxpY2UocGFydHMubGVuZ3RoIC0gMSlcclxuXHJcbiAgICAgICAgdmFyIG46IHN0cmluZyA9IF8uY2FtZWxDYXNlKHBhcnRzLmpvaW4oJy4nKSk7XHJcbiAgICAgICAgcmV0dXJuIHBhcnRzLmpvaW4oJy4nKTtcclxuICAgIH1cclxuICAgIGVsc2VcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0TmFtZShwYXRoOiBzdHJpbmcpIHtcclxuICAgIHZhciBwYXJ0cyA9IHBhdGguc3BsaXQoJy4nKTtcclxuXHJcbiAgICBpZiAocGFydHMubGVuZ3RoID4gMClcclxuICAgICAgICByZXR1cm4gXy5sYXN0KHBhcnRzKTtcclxuICAgIGVsc2VcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxufVxyXG5cclxuZnVuY3Rpb24gZm9ybWF0UGFyYW1ldGVycyhtZXRob2QsIG91dDogKGxpbmUpID0+IHZvaWQpIHtcclxuXHJcbiAgICBvdXQoXCJ7XCIpO1xyXG5cclxuICAgIF8uZm9yRWFjaChtZXRob2QucGFyYW1ldGVycywgKGRhdGEsIGtleSkgPT4ge1xyXG4gICAgICAgIG91dChcIlxcdFwiICsga2V5ICsgXCI6IFwiICsgKHR5cGVzTWFwW2RhdGEudHlwZV0gfHwgZGF0YS50eXBlKSArIFwiLFwiKTtcclxuICAgIH0pXHJcblxyXG4gICAgb3V0KFwifVwiKTtcclxuXHJcbiAgICAvL3JldHVybiBcInsgXFxyXFxuXFx0XFx0XCIgKyBfLm1hcChtZXRob2QucGFyYW1ldGVycywgKGRhdGEsIGtleSkgPT4ga2V5ICsgXCI6IFwiICsgKHR5cGVzTWFwW2RhdGEudHlwZV0gfHwgZGF0YS50eXBlKSkuam9pbihcIiwgXFxyXFxuXFx0XFx0XCIpICsgXCJcXHJcXG5cXHRcXHQgfVwiO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmaXJzdExldHRlclVwKHRleHQ6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIHRleHRbMF0udG9VcHBlckNhc2UoKSArIHRleHQuc3Vic3RyaW5nKDEpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRNZXRob2RQYXJhbWV0ZXJJbnRlcmZhY2VOYW1lKHJlc291cmNlLCBtZXRob2Q6IGdhcGkuZGlzY292ZXJ5LmRlc2NyaXB0aW9uLk1ldGhvZCkge1xyXG4gICAgcmV0dXJuIGZpcnN0TGV0dGVyVXAocmVzb3VyY2UpICsgZmlyc3RMZXR0ZXJVcChnZXROYW1lKG1ldGhvZC5pZCkpICsgXCJSZXF1ZXN0XCI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFR5cGUodHlwZTogYW55KTogc3RyaW5nIHwgVHlwZXNjcmlwdFdyaXRlckNhbGxiYWNrIHtcclxuICAgIGlmICh0eXBlLnR5cGUgPT09IFwiYXJyYXlcIikge1xyXG4gICAgICAgIHJldHVybiAod3JpdGVyOiBUeXBlc2NyaXB0VGV4dFdyaXRlcikgPT4ge1xyXG4gICAgICAgICAgICBsZXQgY2hpbGQgPSBnZXRUeXBlKHR5cGUuaXRlbXMpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgd3JpdGVyLndyaXRlKGNoaWxkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgY2hpbGQgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgY2hpbGQod3JpdGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB3cml0ZXIud3JpdGUoXCJbXVwiKTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAodHlwZS50eXBlID09PSBcIm9iamVjdFwiICYmIHR5cGUucHJvcGVydGllcykge1xyXG4gICAgICAgIHJldHVybiAod3JpdGVyOiBUeXBlc2NyaXB0VGV4dFdyaXRlcikgPT4ge1xyXG4gICAgICAgICAgICB3cml0ZXIuYW5vbnlteXNUeXBlKCgpID0+XHJcbiAgICAgICAgICAgICAgICBfLmZvckVhY2godHlwZS5wcm9wZXJ0aWVzLCAoZGF0YTogYW55LCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZXIuY29tbWVudChmb3JtYXRDb21tZW50KGRhdGEuZGVzY3JpcHRpb24pKTtcclxuICAgICAgICAgICAgICAgICAgICB3cml0ZXIucHJvcGVydHkoa2V5LCBnZXRUeXBlKGRhdGEpLCBkYXRhLnJlcXVpcmVkIHx8IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0eXBlLnR5cGUpIHtcclxuICAgICAgICByZXR1cm4gdHlwZXNNYXBbdHlwZS50eXBlXSB8fCB0eXBlLnR5cGU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0eXBlLiRyZWYpIHtcclxuICAgICAgICByZXR1cm4gdHlwZS4kcmVmO1xyXG4gICAgfVxyXG4gICAgZWxzZSB0aHJvdyBFcnJvcigpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmb3JtYXRDb21tZW50KGNvbW1lbnQ6IHN0cmluZykge1xyXG4gICAgaWYgKCFjb21tZW50KSByZXR1cm4gXCJcIjtcclxuXHJcbiAgICByZXR1cm4gY29tbWVudDtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0TWV0aG9kUmV0dXJuKG1ldGhvZDogZ2FwaS5kaXNjb3ZlcnkuZGVzY3JpcHRpb24uTWV0aG9kKSB7XHJcblxyXG4gICAgaWYgKG1ldGhvZC5yZXNwb25zZSkge1xyXG4gICAgICAgIHJldHVybiBcIlByb21pc2VMaWtlPEFwaVJlc3VsdDxcIiArIG1ldGhvZC5yZXNwb25zZS4kcmVmICsgXCI+PlwiO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFwiUHJvbWlzZUxpa2U8dm9pZD5cIjtcclxuICAgIH1cclxufVxyXG5cclxuY2xhc3MgQXBwIHtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIG91dHB1dCA9IF9fZGlybmFtZSArIFwiLy4uL291dC9cIikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBvdXRwdXQgZGlyZWN0b3J5OiAke3RoaXMub3V0cHV0fWApO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gd3JpdGVzIHNwZWNpZmllZCByZXNvdXJjZSBkZWZpbml0aW9uXHJcbiAgICBwcml2YXRlIHdyaXRlUmVzb3VyY2VzKG91dDogVHlwZXNjcmlwdFRleHRXcml0ZXIsIHJlc291cmNlczogZ2FwaS5kaXNjb3ZlcnkuZGVzY3JpcHRpb24uUmVzb3VyY2VzKSB7XHJcblxyXG4gICAgICAgIF8uZm9yRWFjaChyZXNvdXJjZXMsIChyZXNvdXJjZTogZ2FwaS5kaXNjb3ZlcnkuZGVzY3JpcHRpb24uUmVzb3VyY2UsIHJlc291cmNlTmFtZTogc3RyaW5nKSA9PiB7XHJcblxyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2VJbnRlcmZhY2VOYW1lID0gcmVzb3VyY2VOYW1lWzBdLnRvVXBwZXJDYXNlKCkgKyByZXNvdXJjZU5hbWUuc3Vic3RyaW5nKDEpICsgXCJSZXNvdXJjZVwiO1xyXG5cclxuICAgICAgICAgICAgdGhpcy53cml0ZVJlc291cmNlcyhvdXQsIHJlc291cmNlLnJlc291cmNlcyk7XHJcblxyXG4gICAgICAgICAgICBfLmZvckVhY2gocmVzb3VyY2UubWV0aG9kcywgKG1ldGhvZDogZ2FwaS5kaXNjb3ZlcnkuZGVzY3JpcHRpb24uTWV0aG9kLCBuYW1lOiBzdHJpbmcpID0+IHtcclxuICAgICAgICAgICAgICAgIG91dC5pbnRlcmZhY2UoZ2V0TWV0aG9kUGFyYW1ldGVySW50ZXJmYWNlTmFtZShyZXNvdXJjZU5hbWUsIG1ldGhvZCksICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBfLmZvckVhY2gobWV0aG9kLnBhcmFtZXRlcnMsIChwYXJhbWV0ZXI6IGdhcGkuZGlzY292ZXJ5LmRlc2NyaXB0aW9uLlBhcmFtZXRlciwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5jb21tZW50KGZvcm1hdENvbW1lbnQocGFyYW1ldGVyLmRlc2NyaXB0aW9uKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dC5wcm9wZXJ0eShrZXksIHR5cGVzTWFwW3BhcmFtZXRlci50eXBlXSB8fCBwYXJhbWV0ZXIudHlwZSwgcGFyYW1ldGVyLnJlcXVpcmVkIHx8IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIG91dC5pbnRlcmZhY2UocmVzb3VyY2VJbnRlcmZhY2VOYW1lLCAoKSA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKHJlc291cmNlLm1ldGhvZHMsIChtZXRob2Q6IGdhcGkuZGlzY292ZXJ5LmRlc2NyaXB0aW9uLk1ldGhvZCwgbmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0LmNvbW1lbnQoZm9ybWF0Q29tbWVudChtZXRob2QuZGVzY3JpcHRpb24pKTtcclxuICAgICAgICAgICAgICAgICAgICBvdXQubWV0aG9kKGdldE5hbWUobWV0aG9kLmlkKSwgW3sgcGFyYW1ldGVyOiBcInJlcXVlc3RcIiwgdHlwZTogZ2V0TWV0aG9kUGFyYW1ldGVySW50ZXJmYWNlTmFtZShyZXNvdXJjZU5hbWUsIG1ldGhvZCkgfV0sIGdldE1ldGhvZFJldHVybihtZXRob2QpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChyZXNvdXJjZS5yZXNvdXJjZXMsIChjaGlsZFJlc291cmNlOiBnYXBpLmRpc2NvdmVyeS5kZXNjcmlwdGlvbi5SZXNvdXJjZSwgY2hpbGRSZXNvdXJjZU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZFJlc291cmNlSW50ZXJmYWNlTmFtZSA9IGNoaWxkUmVzb3VyY2VOYW1lWzBdLnRvVXBwZXJDYXNlKCkgKyBjaGlsZFJlc291cmNlTmFtZS5zdWJzdHJpbmcoMSkgKyBcIlJlc291cmNlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0LnByb3BlcnR5KGNoaWxkUmVzb3VyY2VOYW1lLCBjaGlsZFJlc291cmNlSW50ZXJmYWNlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgb3V0LndyaXRlTGluZSgpO1xyXG5cclxuICAgICAgICAgICAgb3V0LndyaXRlTGluZShgdmFyICR7cmVzb3VyY2VOYW1lfTogJHtyZXNvdXJjZUludGVyZmFjZU5hbWV9O2ApO1xyXG4gICAgICAgICAgICBvdXQud3JpdGVMaW5lKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8vIHdyaXRlcyBhcGkgZGVzY3JpcHRpb24gZm9yIHNwZWNpZmllZCBKU09OIG9iamVjdFxyXG4gICAgcHJpdmF0ZSBwcm9jZXNzQXBpKGFwaTogZ2FwaS5kaXNjb3ZlcnkuZGVzY3JpcHRpb24uQXBpLCBhY3R1YWxWZXJzaW9uOiBib29sZWFuKSB7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKGBHZW5lcmF0aW5nICR7YXBpLmlkfSBkZWZpbml0aW9ucy4uLmApO1xyXG5cclxuICAgICAgICB2YXIgbWV0aG9kcyA9IF8ocHJvY2Vzc1Jlc291cmNlKGFwaSkpLmZsYXR0ZW4odHJ1ZSkubWFwKCh4OiBhbnkpID0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIG5hbWVzcGFjZTogZ2V0TmFtZXNwYWNlKHguaWQpLFxyXG4gICAgICAgICAgICAgICAgbmFtZTogZ2V0TmFtZSh4LmlkKSxcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogeFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkudmFsdWUoKSxcclxuICAgICAgICAgICAgZ3JvdXBlZCA9IF8uZ3JvdXBCeShtZXRob2RzLCBtZXRob2QgPT4gbWV0aG9kLm5hbWVzcGFjZSksXHJcbiAgICAgICAgICAgIHN0cmVhbSA9IGZzLmNyZWF0ZVdyaXRlU3RyZWFtKHRoaXMub3V0cHV0ICsgYXBpLm5hbWUgKyAoYWN0dWFsVmVyc2lvbiA/IFwiXCIgOiBcIi1cIiArIGFwaS52ZXJzaW9uKSArIFwiLmQudHNcIiksXHJcbiAgICAgICAgICAgIHdyaXRlciA9IG5ldyBUeXBlc2NyaXB0VGV4dFdyaXRlcihuZXcgSW5kZW50ZWRUZXh0V3JpdGVyKG5ldyBTdHJlYW1Xcml0ZXIoc3RyZWFtKSkpO1xyXG5cclxuICAgICAgICB3cml0ZXIucmVmZXJlbmNlKFwiZ2FwaS5kLnRzXCIpO1xyXG5cclxuICAgICAgICB3cml0ZXIuZGVjbGFyZU5hbWVzcGFjZShcImdhcGlcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB3cml0ZXIubmFtZXNwYWNlKFwiY2xpZW50XCIsICgpID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICBfLmZvckVhY2goYXBpLnNjaGVtYXMsIChzY2hlbWE6IGdhcGkuZGlzY292ZXJ5LmRlc2NyaXB0aW9uLlNjaGVtYSwga2V5KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgd3JpdGVyLmludGVyZmFjZShzY2hlbWEuaWQsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXy5mb3JFYWNoKHNjaGVtYS5wcm9wZXJ0aWVzLCAoZGF0YTogYW55LCBrZXkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5jb21tZW50KGZvcm1hdENvbW1lbnQoZGF0YS5kZXNjcmlwdGlvbikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLnByb3BlcnR5KGtleSwgZ2V0VHlwZShkYXRhKSwgZGF0YS5yZXF1aXJlZCB8fCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMud3JpdGVSZXNvdXJjZXMod3JpdGVyLCBhcGkucmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHdyaXRlci5lbmQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIHJlcXVlc3QodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0KHVybCwgKGVycm9yLCByZXNwb25zZSwgYm9keSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFlcnJvciAmJiByZXNwb25zZS5zdGF0dXNDb2RlID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhcGkgPSBKU09OLnBhcnNlKGJvZHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYXBpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJHb3QgYW4gZXJyb3I6IFwiLCBlcnJvciwgXCIsIHN0YXR1cyBjb2RlOiBcIiwgcmVzcG9uc2Uuc3RhdHVzQ29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBmaWx0ZXJTZXJ2aWNlcyhhcGlzOiBnYXBpLmRpc2NvdmVyeS5kaXJlY3RvcnkuQXBpW10sIHNlcnZpY2U6IHN0cmluZywgYWxsVmVyc2lvbnM6IGJvb2xlYW4pIHtcclxuICAgICAgICBhcGlzID0gXy5maWx0ZXIoYXBpcywgYXBpID0+IHNlcnZpY2UgPT0gbnVsbCB8fCBhcGkubmFtZSA9PT0gc2VydmljZSk7XHJcblxyXG4gICAgICAgIC8vIF8oYXBpcylcclxuICAgICAgICAvLyAgICAgLmdyb3VwQnkoYXBpID0+IGFwaS5uYW1lKVxyXG4gICAgICAgIC8vICAgICAuZWFjaCgodmFyaWFudHMsIGtleSkgPT4gXy5lYWNoKHZhcmlhbnRzLCB2ID0+IHYuYWN0dWFsVmVyc2lvbiA9IHYgPT09IF8ubGFzdCh2YXJpYW50cykpKVxyXG4gICAgICAgIC8vICAgICAudmFsdWUoKTtcclxuXHJcbiAgICAgICAgYXBpcyA9IF8uZmlsdGVyKGFwaXMsIChhcGk6IGdhcGkuZGlzY292ZXJ5LmRpcmVjdG9yeS5BcGkpID0+IGFsbFZlcnNpb25zIHx8IGFwaS5wcmVmZXJyZWQpO1xyXG5cclxuICAgICAgICByZXR1cm4gYXBpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcHJvY2Vzc1NlcnZpY2UodXJsOiBzdHJpbmcsIGFjdHVhbFZlcnNpb246IGJvb2xlYW4pIHtcclxuICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICAucmVxdWVzdCh1cmwpXHJcbiAgICAgICAgICAgIC50aGVuKChhcGk6IGdhcGkuZGlzY292ZXJ5LmRlc2NyaXB0aW9uLkFwaSkgPT4gdGhpcy5wcm9jZXNzQXBpKGFwaSwgYWN0dWFsVmVyc2lvbikpXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRpc2NvdmVyKHNlcnZpY2U6IHN0cmluZyA9IG51bGwsIGFsbFZlcnNpb25zOiBib29sZWFuID0gZmFsc2UpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkRpc2NvdmVyaW5nIEdvb2dsZSBzZXJ2aWNlcy4uLlwiKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICAgICAgLnJlcXVlc3QoXCJodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9kaXNjb3ZlcnkvdjEvYXBpc1wiKVxyXG4gICAgICAgICAgICAudGhlbigoYXBpczogZ2FwaS5kaXNjb3ZlcnkuZGlyZWN0b3J5LkFwaXMpID0+IHRoaXMuZmlsdGVyU2VydmljZXMoYXBpcy5pdGVtcywgc2VydmljZSwgYWxsVmVyc2lvbnMpKVxyXG4gICAgICAgICAgICAudGhlbihpdGVtcyA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNhbid0IGZpbmQgc2VydmljZXNcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJDYW4ndCBmaW5kIHNlcnZpY2VzXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbXMucmVkdWNlKChjdXIsIGFwaTogYW55KSA9PiBjdXIudGhlbigoKSA9PiB0aGlzLnByb2Nlc3NTZXJ2aWNlKGFwaS5kaXNjb3ZlcnlSZXN0VXJsLCBhcGkucHJlZmVycmVkKSksIFByb21pc2UucmVzb2x2ZShudWxsKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG52YXIgcGFyYW1zOiBhbnkgPSBwcm9ncmFtXHJcbiAgICAudmVyc2lvbihcIjAuMC4xXCIpXHJcbiAgICAuYWxsb3dVbmtub3duT3B0aW9uKGZhbHNlKVxyXG4gICAgLm9wdGlvbihcIi11LCAtLXVybCBbdXJsXVwiLCBcInByb2Nlc3Mgb25seSBzcGVjaWZpYyBSRVNUIHNlcnZpY2UgZGVmaW5pdGlvbiBieSB1cmxcIilcclxuICAgIC5vcHRpb24oXCItcywgLS1zZXJ2aWNlIFtuYW1lXVwiLCBcInByb2Nlc3Mgb25seSBzcGVjaWZpYyBSRVNUIHNlcnZpY2UgZGVmaW5pdGlvbiBieSBuYW1lXCIpXHJcbiAgICAub3B0aW9uKFwiLWEsIC0tYWxsXCIsIFwiaW5jbHVkZSBwcmV2aW91c2x5IHZlcnNpb25zXCIsIGZhbHNlKVxyXG4gICAgLm9wdGlvbihcIi1vLCAtLW91dFwiLCBcIm91dHB1dCBkaXJlY3RvcnlcIilcclxuICAgIC5wYXJzZShwcm9jZXNzLmFyZ3YpO1xyXG5cclxudmFyIGFwcCA9IG5ldyBBcHAocGFyYW1zLm91dCk7XHJcblxyXG5pZiAocGFyYW1zLnVybCkge1xyXG4gICAgYXBwXHJcbiAgICAgICAgLnByb2Nlc3NTZXJ2aWNlKHBhcmFtcy51cmwsIHRydWUpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4gY29uc29sZS5sb2coXCJEb25lXCIpKTtcclxufVxyXG5lbHNlIHtcclxuICAgIGFwcFxyXG4gICAgICAgIC5kaXNjb3ZlcihwYXJhbXMuc2VydmljZSwgcGFyYW1zLmFsbClcclxuICAgICAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZyhcIkRvbmVcIikpO1xyXG59Il19